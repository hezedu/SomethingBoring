<!DOCTYPE html>
<html>

  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>vue-router positionStore memory leak</title>
    <style>
      html, body{
        margin: 0;
        padding: 0;
      }
      button{
        font-size: 20px;
        padding: 10px;
      }
    </style>
  </head>
  <body>
  <div id="app">Loading...</div>
  
  
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/vue-router@3.0.1/dist/vue-router.js"></script> -->
  <script src="./vue-router@3.4.9_m_1734.js"></script>
    <script>
    function genPage(isBack){
      
      return {
        template: `<div>
          <h1>vue-router positionStore memory leak</h1>
          <p>Click the button below continuously</p>
          <button v-if="isBack" @click="back">Back</button>
          <button v-else @click="push">push</button>
          <hr />

          <div style="background: #eee; padding: 10px">
            <h2>PositionStore</h2>
            
            <ol>
              <li v-for="(v, k) in map">
                <b>{{k}}: {{v}}</b>
              </li>
              </ol>

          </div>
        </div>`,
        data() {
          return {
            isBack,
            map: window.vueRouterPositionStore
          }
        },
        methods: {
          back(){
            this.$router.back();
          },
          push(){
            this.$router.push('/b');
          }
        }
      }
    }


    const Root = {
      template: '<router-view />'
    }

    const router = new window.VueRouter({
      routes: [
        { path: '/', component: genPage(false) },
        { path: '/b', component: genPage(true) },
      ]
    });
    
    const app = new window.Vue({
      router: router,
      render: h => h(Root)
    });

    router.onReady(() => {
      app.$mount('#app');
    })
    </script>
</body>
</html>
