!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=2)}([function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0),n(1);function i(e){return e<10?"0"+e:e.toString()}var r=window.Vue;r.filter("timeFormat",(function(e,t){if(!e)return"";var n=Number(e);isNaN(n)?n="Z"===e[e.length-1]?e:e.replace(/-/g,"/"):n*=1e3,t=t||"yyyy-MM-dd HH:mm";var i={"M+":(n=new Date(n)).getMonth()+1,"d+":n.getDate(),"H+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[r]:("00"+i[r]).substr((""+i[r]).length)));return t})),r.filter("price",(function(e){return(Number(e)/100).toFixed(2)})),r.filter("time2Min",(function(e){var t=(e=Math.ceil(e))%60,n=e-t;return i(n/=60)+":"+i(t)})),r.filter("numWan",(function(e){var t=Number(e);return t>1e4&&(t=((t/=1e4)-.05).toFixed(1)+"万"),t}));var s=window.Vue;var o={mixins:[{mixins:[{methods:{safeBind:function(e,t,n,i){var r=this.$options._safeBindedMap;r||(r=this.$options._safeBindedMap=Object.create(null));var o=this.$options._safeBindIndex;if(o||(o=this.$options._safeBindIndex=1),this.$options._safeBindIndex=o+1,e instanceof s)if(i){var a=function(e){delete r[o],n(e)};e.$once(t,a),r[o]=function(){e.$off(t,a)}}else e.$on(t,n),r[o]=function(){e.$off(t,n)};else if(i&&!0===i.once){var l=function(e){delete r[o],n(e)};e.addEventListener(t,l,i),r[o]=function(){e.removeEventListener(t,l,i)}}else e.addEventListener(t,n,i),r[o]=function(){e.removeEventListener(t,n,i)}}},destroyed:function(){var e,t=this.$options._safeBindedMap;for(e in t)t[e]()}}],data:function(){return{currentTime:0,duration:1,isPlayed:!1,isPlay:!1,isLoadMeta:!1,isWaiting:!1,isLoadStart:!1,isError:!1,currBuffered:null,isSeeking:!1}},methods:{handleError:function(){this.isError=!0},handleLoadstart:function(){var e=this.$options._tmp_switch_definition;if(e){var t=e.time;t===this.duration&&(t=0),this.$refs.media.currentTime=t,this.currentTime=t,e.isPlay&&this.$refs.media.play(),this.$options._tmp_switch_definition=null}console.log("handleLoadstart"),this.isLoadStart=!0},handleCanplay:function(){this.isWaiting=!1},handleWaitimg:function(){this.isWaiting=!0},handlePlayOnce:function(){console.log("handlePlayOnce"),this.$refs.media.preload="metadata",this.isPlayed=!0},handlePlay:function(){},handlePause:function(){this.isPlay=!1,this.currComment=this.getCurrComment()},handleLoadMetaData:function(){this.isLoadStart=!1,this.isLoadMeta=!0,this.duration=this.$refs.media.duration},handleTimeUpdate:function(){console.log("handleTimeUpdate");var e=this.$refs.media;if(e){if(this.isSeeking)return;return this._isAutoPause?void(this._isAutoPause=!1):(this.autoPause()||(this.currentTime=e.currentTime),e)}},autoPause:function(){var e=this.$refs.media;return!!e&&(this.nextComment.time<=e.currentTime?(this.pause(),this._isAutoPause=!0,this.currentTime=e.currentTime=this.nextComment.time,this.currComment=this.getCurrComment(),this.initNextCommentIndex(),this._is_click_playToggle=!1,!0):void(this.currComment=null))},getCurrComment:function(){var e=this;return this.commentList.find((function(t){return t.time===e.currentTime}))||null},handleSeeking:function(){console.log("handleSeeking"),this.isSeeking=!0},handleSeeked:function(){console.log("handleSeeked"),this.genCurrBuffered(),this.initNextCommentIndex(),this.isSeeking=!1,this.currComment=this.getCurrComment(),this._is_click_playToggle||this.currComment||this.playToggle()},play:function(){this.$refs.media.play()},pause:function(){this.$refs.media.pause()},playToggle:function(){this._is_click_playToggle=!0,this.isPlay?this.pause():this.play()},handleSlideDragStart:function(){console.log("handleSlideDragStart"),this.$options._tmp_upHandle=this.handleTimeUpdate,this.handleTimeUpdate=function(){}},handleSlideDragEnd:function(){this.currentTime=this.$refs.media.currentTime,this.handleTimeUpdate=this.$options._tmp_upHandle},handleSliderChange:function(e){this.$refs.media.currentTime=e},switchDefinition:function(e){this.$options._tmp_switch_definition={time:this.currentTime,isPlay:this.isPlay},this.src=e},handleProgress:function(){this.genCurrBuffered()},genCurrBuffered:function(){var e=this.$refs.media;e&&(this.currBuffered=function(e,t,n){for(var i,r,s=e.length,o=0;o<s;o++)if(i=e.start(o),r=e.end(o),i<=n&&r>n)return{start:i/t*100+"%",end:100*(1-r/t)+"%"};return null}(e.buffered,e.duration,e.currentTime))}}}],props:{ctrlHiddenTime:{type:Number,default:3500}},data:function(){return{isShowCtrl:!0,isEnded:!1,isFullScreen:!1,isHScreen:90===window.orientation||-90===window.orientation}},computed:{statusBarHeight:function(){return"0px"},isShowFnBtn:function(){return!this.isPlay||this.isShowCtrl}},methods:{handleEnded:function(){this.isEnded=!0},handlePlay:function(){this.isEnded&&(this.isEnded=!1,this.currentTime=0),this.isPlay=!0,this.ensureClearTimer(),this.hiddenCtrls(),this.initNextCommentIndex(),this.isPlay=!0,this.currComment=this.getCurrComment(),this._isAutoPauseStarted=null},handleFullScreenClick:function(){this.isFullScreen?this.exitFullScreen():this.launchFullScreen()},launchFullScreen:function(){var e;(e=this.$el).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},exitFullScreen:function(){document.fullscreenElement&&(document.exitFullscreen?document.exitFullscreen():document.mozExitFullScreen?document.mozExitFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())},handlePlayerTouchStart:function(){console.log("handlePlayerTouchStart"),this.ensureClearTimer(),this.isShowCtrl?this.hiddenCtrls():this.showCtrls()},ensureClearTimer:function(){this.$options._tmp_timer&&(clearTimeout(this.$options._tmp_timer),this.$options._tmp_timer=null)},handlePlayerTouchEnd:function(){var e=this;this.ensureClearTimer(),this.isShowCtrl&&(this.$options._tmp_timer=setTimeout((function(){e.$options._tmp_timer=null,e.hiddenCtrls()}),this.ctrlHiddenTime))},showCtrls:function(){this.isShowCtrl=!0},hiddenCtrls:function(){this.isShowCtrl=!1}},mounted:function(){var e=this;this.safeBind(document,"fullscreenchange",(function(){if(document.fullscreenElement){e.isFullScreen=!0;try{window.screen.orientation.lock("landscape-primary").catch((function(e){console.log("window.screen.lock error",e)}))}catch(e){console.log("window.screen.lock error",e)}}else{e.isFullScreen=!1;try{window.screen.orientation.unlock().catch((function(e){console.log("window.screen.lock error",e)}))}catch(e){console.log("window.screen.orientation.unlock error",e)}}})),this.safeBind(window,"orientationchange",(function(){0===window.screen.orientation.type.indexOf("landscape")?e.isHScreen=!0:e.isHScreen=!1})),this.$options._tmp_timer=setTimeout((function(){e.hiddenCtrls()}),this.ctrlHiddenTime)},beforeDestroy:function(){this.ensureClearTimer(),this.isFullScreen&&this.exitFullScreen()}};function a(e,t,n,i,r,s,o,a){var l,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),i&&(u.functional=!0),s&&(u._scopeId="data-v-"+s),o?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},u._ssrRegister=l):r&&(l=a?function(){r.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(u.functional){u._injectStyles=l;var c=u.render;u.render=function(e,t){return l.call(t),c(e,t)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:u}}var l=a({props:["currBuffered"]},(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"lt_video_player_time_ranges"},[this.currBuffered?t("div",{staticClass:"lt_video_player_buffered_range",style:{left:this.currBuffered.start,right:this.currBuffered.end}}):this._e(),this._v(" "),this._t("default")],2)}),[],!1,null,null,null),u=a({mixins:[o],components:{CurrProcessBuffered:l.exports},props:{data:Object,autoFullScreen:{type:Boolean,default:!1}},data:function(){return{nextCommentIndex:0,currComment:null,commentList:[]}},computed:{nextComment:function(){return this.commentList[this.nextCommentIndex]||{time:1/0}}},methods:{handleMarkerClick:function(e){this.setCurrComment(e)},addComment:function(){if(!this.currComment){this.pause();var e=this.currentTime,t=this.commentList.findIndex((function(t){return t.time>e})),n={time:this.currentTime,detail:""};-1===t?this.commentList.push(n):0===t?this.commentList.unshift(n):this.commentList.splice(t,0,n),this.setComment(this.currentTime),this.initNextCommentIndex()}},delComment:function(){var e=this,t=this.commentList.findIndex((function(t){return t===e.currComment}));-1!==t&&(this.commentList.splice(t,1),this.currComment=null,this.initNextCommentIndex())},setComment:function(e){this.currentTime=e,this.initNextCommentIndex(),this.$refs.media.currentTime=e},setCurrComment:function(e){this.pause(),this.setComment(e.time)},initNextCommentIndex:function(){this.nextCommentIndex=this._getNextCommentIndex()},_getNextCommentIndex:function(){for(var e=0,t=this.commentList.length;e<t;e++)if(this.commentList[e].time>this.currentTime)return e;return-1},findNextComment:function(e){for(var t,n=this.nextCommentIndex,i=this.commentList.length;n<i;n++)if(e>=(t=this.commentList[n]).time)return t}},created:function(){this.initNextCommentIndex()}},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"demo_page_wrap"},[e._m(0),e._v(" "),n("div",{staticClass:"demo_wrap"},[n("div",{staticClass:"lt_video_player_wrap lt_video_player_normal",class:{lt_video_player_fullscreen:e.isFullScreen,lt_video_player_h_screen:e.isHScreen}},[n("video",{ref:"media",staticClass:"lt_video_player",attrs:{playsinline:"true",poster:e.data.poster,autoplay:"autoplay",preload:"metadata",src:e.data.src},on:{timeupdate:e.handleTimeUpdate,loadedmetadata:e.handleLoadMetaData,play:e.handlePlay,ended:e.handleEnded,"~play":function(t){return e.handlePlayOnce(t)},loadstart:e.handleLoadstart,pause:e.handlePause,error:e.handleError,progress:e.handleProgress,seeked:e.handleSeeked,seeking:e.handleSeeking}}),e._v(" "),e.isPlayed?[n("div",{directives:[{name:"show",rawName:"v-show",value:!0|e.isShowFnBtn,expression:"isShowFnBtn | true"}],staticClass:"lt_video_player_ctrls"},[null!==e.currComment?n("div",{staticClass:"comment_detail"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.currComment.detail,expression:"currComment.detail"}],domProps:{value:e.currComment.detail},on:{input:function(t){t.target.composing||e.$set(e.currComment,"detail",t.target.value)}}})]):e._e(),e._v(" "),n("div",{staticClass:"lt_video_player_ctrl_bottom",on:{touchstart:function(e){e.stopPropagation()}}},[n("van-icon",{attrs:{name:e.isPlay?"pause":"play"},on:{click:e.playToggle}}),e._v(" "),n("CurrProcessBuffered",{staticClass:"lt_video_player_process_wrap",attrs:{currBuffered:e.currBuffered}},[e._l(e.commentList,(function(t){return n("div",{key:t.time,staticClass:"lt_video_player_marker",class:{lt_video_player_marker_active:t.time===e.currentTime},style:{left:t.time/e.duration*100+"%"},on:{click:function(n){return n.stopPropagation(),e.handleMarkerClick(t)}}})})),e._v(" "),n("van-slider",{class:{marker_actived:null!==e.currComment},attrs:{min:0,"bar-height":10,"button-size":12,"inactive-color":"transparent","active-color":"#fff",disabled:void 0!==e.data.processLimit,max:e.duration},on:{"drag-start":e.handleSlideDragStart,"drag-end":e.handleSlideDragEnd,change:e.handleSliderChange},model:{value:e.currentTime,callback:function(t){e.currentTime=t},expression:"currentTime"}})],2),e._v(" "),n("div",{staticClass:"lt_video_player_time"},[e._v(e._s(e._f("time2Min")(e.currentTime))+"/"+e._s(e._f("time2Min")(e.duration)))]),e._v(" "),n("van-icon",{directives:[{name:"show",rawName:"v-show",value:!0|!e.isFullScreen,expression:"!isFullScreen | true"}],attrs:{name:"enlarge"},on:{click:e.handleFullScreenClick}})],1)]),e._v(" "),e.isPlayed?n("van-loading",{directives:[{name:"show",rawName:"v-show",value:e.isWaiting||e.isLoadStart,expression:"isWaiting || isLoadStart"}],staticClass:"lt_video_player_waiting"}):e._e()]:n("div",{staticClass:"lt_video_player_first_play",on:{touchstart:function(e){e.stopPropagation()},click:e.play}},[n("div",{staticClass:"lt_video_player_big_play_btn"},[n("van-icon",{attrs:{name:e.isPlay?"pause":"play"},on:{click:e.playToggle}})],1)])],2),e._v(" "),n("div",{staticClass:"demo_right"},[n("div",{staticClass:"demo_right_top"},[n("van-button",{attrs:{size:"mini",disabled:null!==e.currComment},on:{click:e.addComment}},[e._v("添加批注")]),e._v(" "),n("van-button",{attrs:{size:"mini",disabled:null===e.currComment,type:"danger"},on:{click:e.delComment}},[e._v("删除批注")])],1),e._v(" "),e._l(e.commentList,(function(t){return n("div",{key:t.time,staticClass:"comment_item",class:{comment_item_active:t.time===e.currentTime,comment_item_next_active:t===e.nextComment},on:{click:function(n){return e.setCurrComment(t)}}},[n("span",{staticClass:"comment_item_time"},[e._v(e._s(e._f("time2Min")(t.time)))])])}))],2)])])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("h2",[this._v("视频批注 Demo\n    "),t("small",[this._v("目前仅支持文字, 且不能移动位置")])])}],!1,null,null,null),c=a({components:{VideoPlayerFa:u.exports},data:function(){return{data:{src:"./static/301790848.mp4",poster:"./static/p2254709850.webp"}}}},(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"root"},[t("VideoPlayerFa",{attrs:{data:this.data}})],1)}),[],!1,null,null,null).exports;new(0,window.Vue)({render:function(e){return e(c)}}).$mount("#app")}]);