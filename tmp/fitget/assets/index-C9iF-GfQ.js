import{bg as e,bh as t,b8 as a,bi as l,bj as r,a1 as n,a5 as o,au as s,aG as i,ar as u,bk as c,bl as d,a2 as g,r as f,f as p,be as m,h as v,a_ as h,a4 as b,bm as y,w as k,ay as x,j as w,aK as S,a as M,aZ as V,a8 as C,bn as I,bo as B,bp as A,a7 as E,aq as z,bq as T,p as j,E as P,br as q,a9 as L}from"./index-CioBjTVG.js";import{u as W}from"./use-id-CcbAo3SX.js";function $(e){return Array.isArray(e)?!e.length:0!==e&&!e}function F(e,t){const{message:a}=t;return r(a)?a(e,t):a||""}function H({target:e}){e.composing=!0}function R({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function D(e){return[...e].length}function K(e,t){return[...e].slice(0,t).join("")}const[O,G]=n("field"),Z={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:o,formatter:Function,clearIcon:s("clear"),modelValue:i(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:s("focus"),formatTrigger:s("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}};const _=L(g({name:O,props:u({},c,Z,{rows:o,type:s("text"),rules:Array,autosize:[Boolean,Object],labelWidth:o,labelClass:d,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(r,{emit:n,slots:o}){const s=W(),i=f({status:"unvalidated",focused:!1,validateMessage:""}),u=p(),c=p(),d=p(),{parent:g}=m(C),L=()=>{var e;return String(null!=(e=r.modelValue)?e:"")},O=e=>I(r[e])?r[e]:g&&I(g.props[e])?g.props[e]:void 0,Z=v((()=>{const e=O("readonly");if(r.clearable&&!e){const e=""!==L(),t="always"===r.clearTrigger||"focus"===r.clearTrigger&&i.focused;return e&&t}return!1})),_=v((()=>d.value&&o.input?d.value():r.modelValue)),J=v((()=>{var e;const t=O("required");return"auto"===t?null==(e=r.rules)?void 0:e.some((e=>e.required)):t})),N=e=>e.reduce(((e,t)=>e.then((()=>{if("failed"===i.status)return;let{value:e}=_;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if($(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return i.status="failed",void(i.validateMessage=F(e,t));if(t.validator){if($(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise((a=>{const r=t.validator(e,t);l(r)?r.then(a):a(r)}))}(e,t).then((a=>{a&&"string"==typeof a?(i.status="failed",i.validateMessage=a):!1===a&&(i.status="failed",i.validateMessage=F(e,t))}))}}))),Promise.resolve()),Q=()=>{i.status="unvalidated",i.validateMessage=""},U=()=>n("endValidate",{status:i.status,message:i.validateMessage}),X=(e=r.rules)=>new Promise((t=>{Q(),e?(n("startValidate"),N(e).then((()=>{"failed"===i.status?(t({name:r.name,message:i.validateMessage}),U()):(i.status="passed",t(),U())}))):t()})),Y=e=>{if(g&&r.rules){const{validateTrigger:t}=g.props,a=B(t).includes(e),l=r.rules.filter((t=>t.trigger?B(t.trigger).includes(e):a));l.length&&X(l)}},ee=(e,t="onChange")=>{const a=e;e=(e=>{var t;const{maxlength:a}=r;if(I(a)&&D(e)>+a){const l=L();if(l&&D(l)===+a)return l;const r=null==(t=u.value)?void 0:t.selectionEnd;if(i.focused&&r){const t=[...e],l=t.length-+a;return t.splice(r-l,l),t.join("")}return K(e,+a)}return e})(e);const l=D(a)-D(e);if("number"===r.type||"digit"===r.type){const t="number"===r.type;e=A(e,t,t)}let o=0;if(r.formatter&&t===r.formatTrigger){const{formatter:t,maxlength:l}=r;if(e=t(e),I(l)&&D(e)>+l&&(e=K(e,+l)),u.value&&i.focused){const{selectionEnd:e}=u.value,l=K(a,e);o=D(t(l))-D(l)}}if(u.value&&u.value.value!==e)if(i.focused){let{selectionStart:t,selectionEnd:a}=u.value;if(u.value.value=e,I(t)&&I(a)){const r=D(e);l?(t-=l,a-=l):o&&(t+=o,a+=o),u.value.setSelectionRange(Math.min(t,r),Math.min(a,r))}}else u.value.value=e;e!==r.modelValue&&n("update:modelValue",e)},te=e=>{e.target.composing||ee(e.target.value)},ae=()=>{var e;return null==(e=u.value)?void 0:e.blur()},le=()=>{var e;return null==(e=u.value)?void 0:e.focus()},re=()=>{const l=u.value;"textarea"===r.type&&r.autosize&&l&&function(l,r){const n=e();l.style.height="auto";let o=l.scrollHeight;if(a(r)){const{maxHeight:e,minHeight:t}=r;void 0!==e&&(o=Math.min(o,e)),void 0!==t&&(o=Math.max(o,t))}o&&(l.style.height=`${o}px`,t(n))}(l,r.autosize)},ne=e=>{i.focused=!0,n("focus",e),x(re),O("readonly")&&ae()},oe=e=>{i.focused=!1,ee(L(),"onBlur"),n("blur",e),O("readonly")||(Y("onBlur"),x(re),q())},se=e=>n("clickInput",e),ie=e=>n("clickLeftIcon",e),ue=e=>n("clickRightIcon",e),ce=v((()=>"boolean"==typeof r.error?r.error:!(!g||!g.props.showError||"failed"!==i.status)||void 0)),de=v((()=>{const e=O("labelWidth"),t=O("labelAlign");if(e&&"top"!==t)return{width:h(e)}})),ge=e=>{if(13===e.keyCode){g&&g.props.submitOnEnter||"textarea"===r.type||E(e),"search"===r.type&&ae()}n("keypress",e)},fe=()=>r.id||`${s}-input`,pe=()=>{const e=G("control",[O("inputAlign"),{error:ce.value,custom:!!o.input,"min-height":"textarea"===r.type&&!r.autosize}]);if(o.input)return M("div",{class:e,onClick:se},[o.input()]);const t={id:fe(),ref:u,name:r.name,rows:void 0!==r.rows?+r.rows:void 0,class:e,disabled:O("disabled"),readonly:O("readonly"),autofocus:r.autofocus,placeholder:r.placeholder,autocomplete:r.autocomplete,autocapitalize:r.autocapitalize,autocorrect:r.autocorrect,enterkeyhint:r.enterkeyhint,spellcheck:r.spellcheck,"aria-labelledby":r.label?`${s}-label`:void 0,onBlur:oe,onFocus:ne,onInput:te,onClick:se,onChange:R,onKeypress:ge,onCompositionend:R,onCompositionstart:H};return"textarea"===r.type?M("textarea",t,null):M("input",j("number"===(a=r.type)?{type:"text",inputmode:"decimal"}:"digit"===a?{type:"tel",inputmode:"numeric"}:{type:a},t),null);var a},me=()=>{const e=o["right-icon"];if(r.rightIcon||e)return M("div",{class:G("right-icon"),onClick:ue},[e?e():M(z,{name:r.rightIcon,classPrefix:r.iconPrefix},null)])},ve=()=>{if(r.showWordLimit&&r.maxlength){const e=D(L());return M("div",{class:G("word-limit")},[M("span",{class:G("word-num")},[e]),P("/"),r.maxlength])}},he=()=>{if(g&&!1===g.props.showErrorMessage)return;const e=r.errorMessage||i.validateMessage;if(e){const t=o["error-message"],a=O("errorMessageAlign");return M("div",{class:G("error-message",a)},[t?t({message:e}):e])}},be=()=>[M("div",{class:G("body")},[pe(),Z.value&&M(z,{ref:c,name:r.clearIcon,class:G("clear")},null),me(),o.button&&M("div",{class:G("button")},[o.button()])]),ve(),he()];return b({blur:ae,focus:le,validate:X,formValue:_,resetValidation:Q,getValidationStatus:()=>i.status}),y(T,{customValue:d,resetValidation:Q,validateWithTrigger:Y}),k((()=>r.modelValue),(()=>{ee(L()),Q(),Y("onChange"),x(re)})),w((()=>{ee(L(),r.formatTrigger),x(re)})),S("touchstart",(e=>{E(e),n("update:modelValue",""),n("clear",e)}),{target:v((()=>{var e;return null==(e=c.value)?void 0:e.$el}))}),()=>{const e=O("disabled"),t=O("labelAlign"),a=(()=>{const e=o["left-icon"];if(r.leftIcon||e)return M("div",{class:G("left-icon"),onClick:ie},[e?e():M(z,{name:r.leftIcon,classPrefix:r.iconPrefix},null)])})();return M(V,{size:r.size,class:G({error:ce.value,disabled:e,[`label-${t}`]:t}),center:r.center,border:r.border,isLink:r.isLink,clickable:r.clickable,titleStyle:de.value,valueClass:G("value"),titleClass:[G("label",[t,{required:J.value}]),r.labelClass],arrowDirection:r.arrowDirection},{icon:a&&"top"!==t?()=>a:null,title:()=>{const e=(()=>{const e=O("labelWidth"),t=O("labelAlign"),a=O("colon")?":":"";return o.label?[o.label(),a]:r.label?M("label",{id:`${s}-label`,for:o.input?void 0:fe(),onClick:e=>{E(e),le()},style:"top"===t&&e?{width:h(e)}:void 0},[r.label+a]):void 0})();return"top"===t?[a,e].filter(Boolean):e||[]},value:be,extra:o.extra})}}}));export{_ as F,Z as f};
