import{_ as e}from"./headItem-BRJ0w2uz.js";import{u as o}from"./useCountDown-BDOyrk-B.js";import{_ as s}from"./index-MP83Mxf-.js";import{M as t}from"./MsgService-B21ojECZ.js";import{u as l,r as a,f as i,h as r,j as m,k as n,s as u,w as d,o as p,c as y,l as c,m as g,n as f,b,a as h,p as C}from"./index-ZSwLI674.js";/* empty css                                              */const x={class:"authority-wrapper"},T={class:"authority-content"},v={class:"mobile-authority-wrapper"},w={__name:"index",props:{security:{type:Object,require:!0},userInfo:{type:Object,require:!0},bizType:{type:String,require:!0},showTitle:{type:Boolean,require:!1}},emits:["next"],setup(w,{emit:V}){const _=V,j=w,{t:D}=l(),I=a({}),S=i(!0),k=r((()=>j.bizType)),M=/^\d{6}$/,q=a({formModelValues:{},submitText:D("提交"),submitDisabled:S,onSubmit:e=>{console.log(e),z(e)},formConfigList:[]});m((()=>{j.security.mobile&&q.formConfigList.push({componentType:"sms",type:"text",key:"sms",label:`${D("将发送验证码到")}${j.userInfo.mobile}`,labelAlign:"top",placeholder:D("请输入验证码"),isImmediate:!1,countDownData:o(),handlerCountdown:(e,o)=>{(async e=>{const o=await t.sendVerifyCode({bizType:k.value,type:"phone"});I.mobile=o,console.log(I),e()})(e)},maxlength:6,rules:[{pattern:M,message:D("请输入6位数字验证码")}]}),j.security.email&&q.formConfigList.push({componentType:"sms",type:"text",key:"emailCode",label:`${D("将发送验证码到")}${j.userInfo.email}`,labelAlign:"top",placeholder:D("请输入验证码"),countDownData:o(),isImmediate:!1,handlerCountdown:(e,o)=>{(async e=>{const o=await t.sendVerifyCode({bizType:k.value,type:"email"});I.email=o,console.log(I),e()})(e)},maxlength:6,rules:[{pattern:M,message:D("请输入6位数字验证码")}]}),j.security.googleCode&&q.formConfigList.push({componentType:"input",type:"text",key:"googleSms",label:D("输入Google验证码"),labelAlign:"top",rightText:D("粘贴"),clickRightText:async e=>{const o=await n();console.log("key",o),q.formModelValues.googleSms=o},placeholder:D("请输入验证码"),rules:[{required:!0,message:D("请输入验证码")}]})}));const z=async({sms:e,emailCode:o,googleSms:s})=>{const t=I.mobile,l=I.email;return j.security.mobile&&!t||j.security.email&&!l?(u(D("请先发送验证码")),!1):void _("next",{bizType:k.value,googleCode:s,verifyCode:e,verifyCodeId:t,emailVerifyCode:o,emailVerifyCodeId:l})};return d((()=>q.formModelValues),(e=>{console.log("newFormData",e),(e=>{(!j.security.mobile||j.security.mobile&&e.sms&&6==e.sms.length)&&(!j.security.email||j.security.email&&e.emailCode&&6==e.emailCode.length)&&(!j.security.googleCode||j.security.googleCode&&e.googleSms&&6==e.googleSms.length)?S.value=!1:S.value=!0})(e)}),{immediate:!0,deep:!0}),(o,t)=>{const l=e;return p(),y("div",x,[w.showTitle?(p(),c(l,{key:0,headTt:g(D)("安全认证")},null,8,["headTt"])):f("",!0),b("div",T,[b("div",v,[h(s,C({modelValue:q.formModelValues,"onUpdate:modelValue":t[0]||(t[0]=e=>q.formModelValues=e)},q),null,16,["modelValue"])])])])}}};export{w as _};
