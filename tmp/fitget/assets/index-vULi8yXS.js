const __vite__fileDeps=["assets/switchPhone-C2WNRO4p.js","assets/securityAuthorityTip-jGWCK-y_.js","assets/index-CioBjTVG.js","assets/index-BWk-JvvK.css","assets/securityAuthorityTip-CtfJNRa0.css","assets/switchAuthority-BdnQxnqg.js","assets/switchAuthority-DgQdsq9R.css","assets/icon_safe_phone-DnUmqWkN.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{u as e,r as a,f as l,s as o,U as s,w as t,o as n,c as i,a as u,p as r,_ as m,t as d,x as p,q as c,h as v,j as y,l as f,m as b,n as _,aU as h,am as x}from"./index-CioBjTVG.js";import{_ as g}from"./headItem-Cz9qCjk4.js";import{u as C}from"./useCountDown-CQ69-YoB.js";import{_ as I}from"./chooseCountry.vue_vue_type_style_index_0_lang-Ll9qT5AW.js";import{_ as j}from"./index-p6Lr4oSA.js";import{M as w}from"./MsgService-B2ZXYJt1.js";import{b as V}from"./validators-DCIwloLt.js";import{_ as T}from"./index-Csiaqh1k.js";import"./index-h3qOpuro.js";import"./index-C9iF-GfQ.js";import"./use-id-CcbAo3SX.js";/* empty css                                              */import"./index-CaK62ptd.js";/* empty css                                              */const M={class:"mobile-authority-wrapper"},D="bind-mobile",O={__name:"index",props:{security:{type:Object,require:!0},userInfo:{type:Object,require:!0}},emits:["next"],setup(m,{emit:d}){const p=d,c=m,{t:v}=e(),y=a({}),f=l(!0),b=l(!1),_=l(null),h=l(null),x=/^\d{6}$/,g=e=>{h.value=e.icon,_.value=e.countryCode},T=a({formModelValues:{},submitText:v("提交"),submitDisabled:f,onSubmit:e=>{console.log(e),O(e)},formConfigList:[{componentType:"input",type:"text",key:"mobile",areaCode:_,leftIcon:"left-icon",placeholder:v("请输入手机号"),onChooseCountry:()=>{b.value=!0},rules:[{required:!0,message:v("请输入手机号")},{validator:V,trigger:["onBlur"]}]},{componentType:"sms",type:"text",key:"sms",label:`${v("将发送验证码到")}${v("您的新手机号码")}`,labelAlign:"top",placeholder:v("请输入验证码"),isImmediate:!1,countDownData:C(),handlerCountdown:(e,a)=>{(async e=>{if(!_.value||!T.formModelValues.mobile)return!1;const a=await w.sendVerifyCodeToReceiver({bizType:D,fullAccount:_.value+"-"+T.formModelValues.mobile});y.mobile=a,console.log(y),e()})(e)},maxlength:6,rules:[{pattern:x,message:v("请输入6位数字验证码")}]},{componentType:"sms",type:"text",key:"emailCode",label:`${v("将发送验证码到")}${c.userInfo.email}`,labelAlign:"top",placeholder:v("请输入验证码"),countDownData:C(),isImmediate:!1,handlerCountdown:(e,a)=>{(async e=>{const a=await w.sendVerifyCode({bizType:D,type:"email"});y.email=a,console.log(y),e()})(e)},maxlength:6,rules:[{pattern:x,message:v("请输入6位数字验证码")}]}]}),O=async({mobile:e,sms:a,emailCode:l})=>{const t=y.mobile,n=y.email;if(!t||!n)return o(v("请先发送验证码")),!1;await s.bindEmailOrMobile({mobileOrEmail:_.value+"-"+e,verifyCode:a,verifyCodeId:t,bizType:D,emailVerifyCode:l,emailVerifyCodeId:n}),p("next")};return t((()=>T.formModelValues),(e=>{console.log("newFormData",e),(e=>{f.value=!e.sms})(e)}),{immediate:!0,deep:!0}),(e,a)=>(n(),i("div",M,[u(j,r({modelValue:T.formModelValues,"onUpdate:modelValue":a[0]||(a[0]=e=>T.formModelValues=e)},T),null,16,["modelValue"]),u(I,{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=e=>b.value=e),onChoose:g},null,8,["modelValue"])]))}},k={class:"phone-auth-wrapper"},U={key:0,class:"phone-secure-wrapper"},E=m({__name:"index",setup(a){const t=h((()=>x((()=>import("./switchPhone-C2WNRO4p.js")),__vite__mapDeps([0,1,2,3,4,5,6,7])))),r=d(),m=p(),{t:C}=e(),I=c(),j=v((()=>I.userInfo)),w=v((()=>null==I.userInfo?null:I.userInfo.security)),V=l(C("手机验证")),M=l(!0),D=l(!1),E=l(!1),S=l(!1);l(!1),v((()=>m.query));const $=()=>{r.push({name:"userCenterSecure"})},q=e=>{if(e)M.value=!1,j.mobile?(S.value=!0,V.value=C("启用手机验证")):(D.value=!0,V.value=C("绑定手机"));else{if(!w.value.email)return o(C("邮箱和手机至少需要绑定一个")),!1;M.value=!1,E.value=!0,V.value=C("解绑手机")}},z=v((()=>{let e=w.value;return!!e.mobile&&!e.email})),A=async e=>{await s.unbindEmailOrMobile(e),E.value=!1,M.value=!0,s.getUserInfo()};return y((async()=>{s.getUserInfo()})),(e,a)=>{const l=g;return n(),i("div",k,[u(l,{headTt:V.value,goBack:$},null,8,["headTt"]),j.value?(n(),i("div",U,[M.value?(n(),f(b(t),{key:0,onOnSwitch:q,isSwitchOn:w.value.mobile,disabled:z.value},null,8,["isSwitchOn","disabled"])):_("",!0),D.value?(n(),f(O,{key:1,security:w.value,userInfo:j.value,onNext:a[0]||(a[0]=e=>{D.value=!1,M.value=!0,b(s).getUserInfo()})},null,8,["security","userInfo"])):_("",!0),E.value?(n(),f(T,{key:2,bizType:"unbind-mobile",security:w.value,userInfo:j.value,onNext:A},null,8,["security","userInfo"])):_("",!0)])):_("",!0)])}}},[["__scopeId","data-v-2dee56b0"]]);export{E as default};
