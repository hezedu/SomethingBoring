import{bz as e,bA as t,bB as r,bC as o,_ as a,a2 as s,bD as i,bE as n,bF as l,bG as c,bH as u,o as d,c as _,n as h}from"./index-ZSwLI674.js";const p="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAwJJREFUaEPtmDFoE2EUx//vmpaC2i4VLDgotlBxaAfdvJBAxYo2UdDBQdTNzQ4tOAimICjUoW5uuhSXQs1ZNKCSenGzgoKDYIQODkKF2oLQNpd7ksu1taVpvnzvog1cIFO+997/9/9/x31fCA3+oQbXjxDgfycYJhAmIHQg3EJCA8XldU2Ac4k7JYVkWqNipRUa1A2Ac+d6gaaP3lx2YxR9/rYeEHUESE4BOF8Wza/JtE41DMAm99dVF/vInP4UNERdEuDc3+6vS35GZvrCrgfY3n1ftsPdFLfyQUIEnkAF9/1HAU8omr6+awH43eAxsPG5skB24OBokCmIE+BsrBXY04UW4whcugHQwM4OcwYGP8Kq+w34naf4zLIkEWUAzg4cQktzL1yjB4QusP8lHJQIAOM7CHmQmwfTFxg8h9XCB4pn5lT6KgF4LkfaFgBqVWkqXsP4hc7VA9T9cqVaLyUA71VkJ6dAay+mam2FvzNnKGqdUemiDlBKoan9ad0hGJMoLl5RfTaUAbwUsrGID3FRxZ2a15TFX6b4jKNaWxPABkTbGIiGVIcorWMeR3FppBbxpb41A6yJYTs5BsKwkrhqixgPKJoeqbZsu9+1Abw0vPM+pXQGb9RwSnJfEAGUIbY9uKkyTZKZvqS6OPAE/BReAdSvJ0J+T5AnYCfmQdShBcD8k6LWfq1av0gEwNnBDkSMeYkAOIVOir/4odtDBmAnT4OQ0R3u1XGxn6LTb3R7yAByiZsAjesOL9fxEJnWQ90eMgA7+RiEaxWGzwC4BaewgkjkXsVjNssuOTKAXOI9QMe3AMyC3eGtf6OwnTgLorsA+jav51kyrRP/PAH/XLQAwt7yTkAeBqfopDWxkxi2B5Mgug9Qj7+FluEs7av1CLE2QzsB747Q1P7Va2TwbRSWJlRFeLXN7VfhcgogB8XFw6q1W83RBvBMz8ZK7i/rDi9fRwHVo3Nd3sS6ezeoOlECQYmQ9AkBJO4FURsmEISLkh5hAhL3gqgNEwjCRUmPhk/gD9z79jEjPM/UAAAAAElFTkSuQmCC",g="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAzBJREFUaEPtmD9oE2EYxp/3UkNK41ZBQXAwQsXBDoqjChUFES3o4CDqpJsFm8sF9C5fKs2ZS6VubrqULoUKDhasUGcdLAgqROjgICg4GNsYe/fKNW1Ng8n9y9UW7pYM9/55fu/zknxfCNv8oW2uHxHA/3YwciByIOAEohVqN8B8sXjcfq/K8quAg26ZHqoD+YLxHISEqqRPbjuAvD52GLDergiX+ERYLoTmQF4vTgN0oT55nlUV+VQYLoQCsGH666qlflW5Pd9piJAAGqe/Jpmfqoo8uOUB/j39umyTlw+IbLbcSYiOO7Bx95ul8hNVka9vWYC8/uAQYL5rLZCXTTYPdtKFwA5ompageDxFsfh+YtwE4UzbCTNmmPCIzdonrtXKQohqEEdcAWialkS8JyXFaJ/E6GNwCkQp2J+gvUEEAPwZoDKYywTpgwVrga3fH7lWWxBCVJxqOwJomtYVSySfOU7WqZPX94wZs1o5J4RYbpfqCGAn22sSSySnNw2iLn7QzXq5AliH6O6Z/Pvr6nWkruOnzKXKFTfi7YquAVYhumLdyUkAF13L8RZoi7/stDaNJT0BNEAYAIa8aXOMHjeXKmkv4j070Cghrxs2xLCjLHcBJVVJp92Fbozy7EBj+sh9Q2NGzk/jtRwi5O5m0sJvjUAAdtP2RwdHWVOqkr7kGNUmoAMAxgsAA75EMGbVbDrQPaETAF8B9PoBYOCbpqR3+cldX8EgyblcqVdKsA3g+zGXeI8Q8he/BQI5IPTSaQLP+G1u5zFZA1om89JvjUAAI3rxFoPG/TZfAQAPaYr80G+NQAD5QukxiK+1aD4HC4rJ/CsmoQCiFsfsYJecQABCL74m0JFGAAa/IQnDzX+jCN04C+AeAf3N8ZoiH910B1aP2d9BSNZXAWUQ5bTM8EQ7MUI3zoOhE6FvJY65alZ/7vR6hAj8LZQbHe2TpB3v2b6QkHTHWvwx4VaEfTyXupNXAeQI2B3ksu97hbSCMSBJOGYtVsbcHn2bnamD9Nyw2JwX2eycnzXyDeCnWRg5EUAYU/VSM3LAy7TCiI0cCGOqXmpGDniZVhixkQNhTNVLzT9OPh9Ad4TGngAAAABJRU5ErkJggg==";function m(e,t){e.forEach(((e,r)=>{r===t?(e[0].style.color="#3272cd",e[0].style.backgroundColor="#1e2237"):(e[0].style.color="#68696b",e[0].style.backgroundColor="#1E2126")}))}function A(e){switch(e){case 0:return"Line";case 1:return"15";case 2:return"60";case 3:return"240";case 4:return"1D";case 5:return"1";case 6:return"3";case 7:return"5";case 8:return"30";case 9:return"120";case 10:return"360";case 11:return"720";case 12:return"1W"}}const b=s({name:"ChartTradingView",mixins:[{methods:{show(){document.getElementById(this.containerId).childNodes[0].setAttribute("style","display:block;width:100%;height:100%;")},widget_onChartReady(){const e=this.$options.__tmp_widget;this.$options.__tmp_is_not_create_resolution_btn=!0,e.onChartReady((()=>{this.createStudy()}))},createResolutionBtn(){const o=this,a=o,s=o.$options.__tmp_widget,i=function(e,t){s.applyOverrides({"mainSeriesProperties.style":t})};let n=!1;const l=[];[].forEach(((c,u)=>{const d=s.createButton({align:"Depth"==c?"right":"left"}).append(c);l.push(d),d.on("click",(function(c){if(!n){n=!0;const e=a.getCurrWidgetIndex();return m(l,e),i(c.currentTarget,a.currChartType),o.$options.__tmp_old_widget_index=e,void console.log("tradingView WTF first click",e)}const d=o.$options.__tmp_old_widget_index;if(console.log("tradingView widget click",d,u),d===u)return;o.$options.__tmp_old_widget_index=u,m(l,u);let _=a.currChartType;if(0===u){if(_=r,1===d)return console.log("Line 1min",_),i(c.currentTarget,_),void o.setStorageItem("currChartType",_)}else if(_=e,0===d&&1===u)return console.log("Line 1min re",_),i(c.currentTarget,_),void o.setStorageItem("currChartType",_);const h=t(u);s.chart().setResolution(h,(()=>{console.log("tradingView setResolution success"),o.setStorageItem("currResolution",h),o.setStorageItem("currChartType",_),o.resetCurrPairTmp(),i(c.currentTarget,_)}))}))}))},createStudy(){const e=this,t=["#965fc4","#84aad5","#55b263","#b7248a"],r=this.$options.__tmp_widget;[5,10,30,60].forEach((function(o,a){r.chart().createStudy("Moving Average",!1,!1,[o],(function(e){}),{"plot.color.0":t[a],precision:e.currPair.maxPriceDecimalDigit})})),r.chart().createStudy("Change",!1,!1)},getCurrWidgetIndex(){if(this.currChartType===r)return 0;let e=o.indexOf(this.currResolution);return-1!==e?e+1:e}}}],props:["lineType","currPair","containerId","clearCurrAndSubscribeTradeRealLine","getTradeLineAllData","unsubscribeCurrTradeRealLine"],data(){let e=A(this.lineType)||i;return n[e]||(e=i),{currResolution:e,currChartType:l}},mounted(){this.appendScript((()=>this.initWidget()))},methods:{initWidget(){setTimeout((()=>{void 0!==window.TradingView&&this.createTradingView()}),300)},appendScript(e){const t=document.createElement("script");t.id=this.containerId+"-script",t.type="text/javascript",t.async=!0,t.src="/charting_library/charting_library.min.js",t.onload=e,document.getElementsByTagName("head")[0].appendChild(t)},handleReConnect(){this.changeExchange()},createTradingView(){const e=this,t=this.currPair;this.$options.__tmp_widget=new window.TradingView.widget({fullscreen:!1,autosize:!0,debug:!1,height:e.$el.offsetHeight,symbol:t.name?t.name:t.leftKey+"/"+t.rightKey,container_id:e.containerId,datafeed:C(e),library_path:"/charting_library/",locale:e.getLanguage(),interval:e.currResolution,allow_symbol_change:!0,theme:"Dark",width:"100%",indicators_file_name:"customIndex.js",height:"100%",overrides:{"mainSeriesProperties.style":this.currChartType,volumePaneSize:"small","scalesProperties.fontSize":11,"scalesProperties.textColor":"#b7c2ce","scalesProperties.lineColor":"#1e334e","scalesProperties.background":"#1e334e","paneProperties.background":"#141516","paneProperties.vertGridProperties.color":"#1e334e","paneProperties.horzGridProperties.color":"#1e334e","paneProperties.crossHairProperties.color":"#fafafa","paneProperties.legendProperties.showLegend":!1,"mainSeriesProperties.candleStyle":{upColor:"#56CA00",downColor:"#FF4C51",drawBorder:!0,borderColor:"#FF4C51",borderUpColor:"#56CA00",borderDownColor:"#FF4C51",drawWick:!0,wickColor:"#737375",wickUpColor:"#56CA00",wickDownColor:"#FF4C51",barColorsOnPrevClose:!1},"mainSeriesProperties.areaStyle.color1":"rgba(0,5,15,0.3)","mainSeriesProperties.areaStyle.color2":"rgba(0,5,15,0.3)","mainSeriesProperties.areaStyle.linecolor":"#7a98f7","mainSeriesProperties.areaStyle.linestyle":1,"mainSeriesProperties.areaStyle.linewidth":.5,"mainSeriesProperties.areaStyle.priceSource":"close"},studies_overrides:{"volume.volume.color.0":"#FF4C51","volume.volume.color.1":"#56CA00","volume.volume.transparency":50},enabled_features:["hide_last_na_study_output","move_logo_to_main_pane","side_toolbar_in_fullscreen_mode","hide_left_toolbar_by_default"],disabled_features:["use_localstorage_for_settings","header_fullscreen_button","header_chart_type","header_resolutions","header_interval_dialog_button","border_around_the_chart","header_symbol_search","show_interval_dialog_on_key_press","header_compare","header_undo_redo","header_saveload","header_screenshot","timeframes_toolbar","go_to_date","volume_force_overlay"],loading_screen:{backgroundColor:"#141516",foregroundColor:"#00b07c"},custom_css_url:"css/night.css"}),this.show(),this.widget_onChartReady()},handleGetBars(e,t){console.log("tradingView resolution",e);const r=this.$options;r.__tmp_is_not_create_resolution_btn&&(r.__tmp_is_not_create_resolution_btn=null,this.createResolutionBtn());const o=n[this.currResolution].api,a=this.currPair.symbol+"."+o;if(r.__tmp_k_request_k===a&&r.__tmp_not_data)return void t([],{noData:!0});r.__tmp_k_request_k=a;const s=r.__tmp_pre_timestamp||c();console.log("tradingView handleGetBars start",a,r.__tmp_pre_timestamp),console.log("tradingView handleGetBars klineTime",o),console.log("tradingView handleGetBars timestamp",s),this.getTradeLineAllData({symbol:this.currPair.symbol,klineTime:o,timestamp:s,count:u},(e=>{if(console.log("tradingView rawData request end",e.length),r.__tmp_k_request_k!==a)return;let o;console.log("tradingView rawData request end noBlock"),e.length&&(r.__tmp_pre_timestamp=e[0][0],console.log("tradingView set __tmp_pre_timestamp",r.__tmp_pre_timestamp)),e.length<u?(o=!0,r.__tmp_not_data=!0):(o=!1,r.__tmp_not_data=!1),console.log("tradingView set __tmp_not_data",r.__tmp_not_data,e.length);const s=e.map(this.transferData);t(s,{noData:o})}))},handleSubscribeBar(e){const t=n[this.currResolution].api;this.clearCurrAndSubscribeTradeRealLine({symbol:this.currPair.symbol,klineTypeAndVal:t},(t=>{e(this.transferData(t))}))},handleUnsubscribeBar(){this.unsubscribeCurrTradeRealLine()},transferData:e=>({time:1e3*e[0],close:1*e[4],open:1*e[1],high:1*e[2],low:1*e[3],volume:1*e[5]}),changeExchange(){console.log("tradingView changeExchange");this.$options.__tmp_k_request_k=null,this.resetCurrPairTmp(),this.unsubscribeCurrTradeRealLine(),this.resetTradingview()},resetCurrPairTmp(){console.log("tradingView resetCurrPairTmp");const e=this.$options;e.__tmp_pre_timestamp=0,e.__tmp_not_data=null},getLanguage(){let e=this.$i18n.locale;return"zh-hk"==e?e="zh-hk":"en-us"==e&&(e="zh"),e},resetTradingview(){this.$options.__tmp_widget.remove(),this.createTradingView()},getStorageItem(e){return localStorage.getItem(this.containerId+"_"+e)},setStorageItem(e,t){return this[e]=t,localStorage.setItem(this.containerId+"_"+e,t)},changeChartType(e){this.$options.__tmp_widget.chart().setChartType(e)},changeResolution(e){const t=this.$options.__tmp_widget;this.currResolution=e,t.chart().setResolution(n[e].widget),this.resetCurrPairTmp()}},beforeUnmount(){try{this.$options.__tmp_widget.remove()}catch(e){}},created(){console.log("created")},unmounted(){this.unsubscribeCurrTradeRealLine()},watch:{"currPair.symbol"(){this.changeExchange()},lineType(t,o){let a=A(t),s=A(o);console.log(a,s),"Line"==s&&this.changeChartType(e),"Line"==a&&this.changeChartType(r),"Line"==a&&(a="1"),this.changeResolution(a)}}});function C(e){return{onReady(t){setTimeout((()=>{t({supported_resolutions:o,interval:e.currResolution,supports_group_request:!1,supports_marks:!1,supports_search:!1,supports_timescale_marks:!1})}))},resolveSymbol(t,r,a){setTimeout((()=>{r({name:t,"exchange-traded":"","exchange-listed":"",minmov:1,minmov2:0,pointvalue:1,session:"24x7",timezone:"UTC",has_intraday:!0,has_no_volume:!1,volume_precision:1,description:t.toUpperCase(),interval:e.currResolution,supported_resolutions:o,pricescale:Math.pow(10,e.currPair.maxPriceDecimalDigit||8),ticker:t.toUpperCase()})}))},calculateHistoryDepth(e,t,r){},getBars(t,r,o,a,s,i,n){e.handleGetBars(r,s,n)},subscribeBars(t,r,o,a,s){e.handleSubscribeBar(o)},unsubscribeBars(t){e.handleUnsubscribeBar(e),console.log("取消订阅K线数据")}}}const w=["id"];const y=a(b,[["render",function(e,t,r,o,a,s){return e.containerId?(d(),_("div",{key:0,id:e.containerId,class:"f-fill"},null,8,w)):h("",!0)}]]);export{y as T,p as _,g as a};
